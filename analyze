#!/usr/bin/env bash

project="$1"
dbfile="$project/tree.sqlite"
selfdir="$(dirname $0)"

set -e

if ! test "$#" -eq 1; then
	echo "Usage: $0 <obs-project>"
	exit 1
fi

echo "Updating checkout of $project..."
#"$selfdir/osc-checkout-project" "$project"

if ! test -d "$project" || ! test -d "$project/.osc"; then
	echo "$project is not a valid OBS checkout"
	exit 1
fi

echo "Analyzing OBS tree..."
mono --debug "$selfdir/obs-tree-analyzer.exe" "$project" "$dbfile"

echo "Done."
